{
  String plainQuery=SQLUtils.stripComments(session.getDataSource(),query).toUpperCase();
  if (!plainQuery.startsWith("SELECT")) {
    throw new DBCException("Only SELECT statements could produce execution plan");
  }
  JDBCSession connection=(JDBCSession)session;
  try {
    JDBCPreparedStatement dbStat=connection.prepareStatement("EXPLAIN EXTENDED " + query);
    try {
      JDBCResultSet dbResult=dbStat.executeQuery();
      try {
        rootNodes=new ArrayList<DBCPlanNode>();
        while (dbResult.next()) {
          MySQLPlanNode node=new MySQLPlanNode(null,dbResult);
          rootNodes.add(node);
        }
      }
  finally {
        dbResult.close();
      }
    }
  finally {
      dbStat.close();
    }
  }
 catch (  SQLException e) {
    throw new DBCException(e);
  }
}
