{
  if (clearData) {
    this.removeAll();
  }
  IGridContentProvider contentProvider=getContentProvider();
  if (contentProvider == null) {
    return;
  }
  this.currentVisibleItems=contentProvider.getRowCount();
  if (clearData) {
    this.topIndex=-1;
    this.bottomIndex=-1;
    this.startColumnIndex=-1;
    this.endColumnIndex=-1;
    int columnCount=contentProvider.getColumnCount();
    for (Integer i=0; i < columnCount; i++) {
      GridColumn column=new GridColumn(this,SWT.NONE);
      ILabelProvider labelProvider=getColumnLabelProvider();
      column.setText(labelProvider.getText(i));
      column.setImage(labelProvider.getImage(i));
      if (labelProvider instanceof ITooltipProvider) {
        column.setHeaderTooltip(((ITooltipProvider)labelProvider).getTooltip(i));
      }
      contentProvider.updateColumn(column);
    }
    if (getColumnCount() == 1) {
      GridColumn column=getColumn(0);
      int columnWidth=column.computeHeaderWidth();
      int gridWidth=getSize().x - getRowHeaderWidth() - getHScrollSelectionInPixels()- getVerticalBar().getSize().x;
      if (gridWidth > columnWidth) {
        columnWidth=gridWidth;
      }
      column.setWidth(columnWidth);
    }
 else {
      int totalWidth=0;
      for (      GridColumn curColumn : columns) {
        curColumn.pack();
        totalWidth+=curColumn.getWidth();
      }
      int clientWidth=getClientArea().width;
      if (totalWidth > clientWidth) {
        int normalWidth=0;
        List<GridColumn> fatColumns=new ArrayList<GridColumn>();
        for (        GridColumn curColumn : columns) {
          if (curColumn.getWidth() > maxColumnDefWidth) {
            fatColumns.add(curColumn);
          }
 else {
            normalWidth+=curColumn.getWidth();
          }
        }
        if (!fatColumns.isEmpty()) {
          int freeSpace=(clientWidth - normalWidth - getBorderWidth()- rowHeaderWidth- (vScroll.getControl() == null ? 0 : vScroll.getControl().getSize().x)) / fatColumns.size();
          int newFatWidth=(freeSpace > maxColumnDefWidth ? freeSpace : maxColumnDefWidth);
          for (          GridColumn curColumn : fatColumns) {
            curColumn.setWidth(newFatWidth);
          }
        }
      }
    }
  }
  updateScrollbars();
}
