{
  if (!project.isOpen()) {
    log.warn("Project '" + project.getName() + "' is not open - can't get datasource registry");
    return null;
  }
  DataSourceRegistry dataSourceRegistry=projectDatabases.get(project);
  if (dataSourceRegistry == null) {
    throw new IllegalStateException("Project '" + project.getName() + "' not found in registry");
  }
  return dataSourceRegistry;
}
