{
  this.type=type;
  this.contents=contents;
  values=new LinkedHashMap<DBSAttributeBase,Object>();
  try {
    Object[] attrValues=contents == null ? null : contents.getAttributes();
    if (type instanceof DBSEntity) {
      DBSEntity entity=(DBSEntity)type;
      Collection<? extends DBSEntityAttribute> entityAttributes=entity.getAttributes(context.getProgressMonitor());
      int valueCount=attrValues == null ? 0 : attrValues.length;
      if (attrValues != null && entityAttributes.size() != valueCount) {
        log.warn("Number of entity attributes (" + entityAttributes.size() + ") differs from real values ("+ valueCount+ ")");
      }
      for (      DBSEntityAttribute attr : entityAttributes) {
        int ordinalPosition=attr.getOrdinalPosition() - 1;
        if (ordinalPosition < 0 || attrValues != null && ordinalPosition >= valueCount) {
          log.warn("Attribute '" + attr.getName() + "' ordinal position ("+ ordinalPosition+ ") is out of range ("+ valueCount+ ")");
          continue;
        }
        Object value=attrValues != null ? attrValues[ordinalPosition] : null;
        DBDValueHandler valueHandler=DBUtils.findValueHandler(context,attr);
        value=valueHandler.getValueFromObject(context,attr,value,false);
        values.put(attr,value);
      }
    }
 else     if (attrValues != null) {
      if (metaData != null) {
        int attrCount=metaData.getColumnCount();
        if (attrCount != attrValues.length) {
          log.warn("Meta column count (" + attrCount + ") differs from value count ("+ attrValues.length+ ")");
          attrCount=Math.min(attrCount,attrValues.length);
        }
        for (int i=0; i < attrCount; i++) {
          Object value=attrValues[i];
          DBSAttributeBase attr=new StructAttribute(metaData,i + 1);
          value=DBUtils.findValueHandler(context,attr).getValueFromObject(context,attr,value,false);
          values.put(attr,value);
        }
      }
 else {
        log.warn("Data type '" + contents.getSQLTypeName() + "' isn't resolved as structured type. Use synthetic attributes.");
        for (int i=0, attrValuesLength=attrValues.length; i < attrValuesLength; i++) {
          Object value=attrValues[i];
          DBSAttributeBase attr=new StructAttribute(i,value);
          value=DBUtils.findValueHandler(context,attr).getValueFromObject(context,attr,value,false);
          values.put(attr,value);
        }
      }
    }
  }
 catch (  DBException e) {
    throw new DBCException("Can't obtain attributes meta information",e);
  }
catch (  SQLException e) {
    throw new DBCException("Can't read structure data",e);
  }
}
