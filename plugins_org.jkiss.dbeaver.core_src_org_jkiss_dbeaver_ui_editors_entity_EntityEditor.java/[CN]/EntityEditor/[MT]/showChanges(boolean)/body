{
  DBECommandContext commandContext=getCommandContext();
  if (commandContext == null) {
    return IDialogConstants.CANCEL_ID;
  }
  Collection<? extends DBECommand> commands=commandContext.getFinalCommands();
  StringBuilder script=new StringBuilder();
  for (  DBECommand command : commands) {
    try {
      command.validateCommand();
    }
 catch (    final DBException e) {
      UIUtils.runInUI(null,new Runnable(){
        @Override public void run(){
          UIUtils.showErrorDialog(getSite().getShell(),"Validation",e.getMessage());
        }
      }
);
      return IDialogConstants.CANCEL_ID;
    }
    script.append(DBUtils.generateScript(command.getPersistActions()));
  }
  ChangesPreviewer changesPreviewer=new ChangesPreviewer(script,allowSave);
  UIUtils.runInUI(getSite().getShell(),changesPreviewer);
  return changesPreviewer.getResult();
}
