{
  if (storage == null && blob != null) {
    long contentLength=getContentLength();
    if (contentLength < DBeaverCore.getInstance().getGlobalPreferenceStore().getInt(PrefConstants.MEMORY_CONTENT_MAX_SIZE)) {
      try {
        storage=BytesContentStorage.createFromStream(blob.getBinaryStream(),contentLength,DBeaverCore.getInstance().getGlobalPreferenceStore().getString(PrefConstants.CONTENT_HEX_ENCODING));
      }
 catch (      Exception e) {
        throw new DBCException(e);
      }
    }
 else {
      IFile tempFile;
      try {
        tempFile=ContentUtils.createTempContentFile(monitor,"blob" + blob.hashCode());
      }
 catch (      IOException e) {
        throw new DBCException(e);
      }
      try {
        ContentUtils.copyStreamToFile(monitor,blob.getBinaryStream(),contentLength,tempFile);
      }
 catch (      Exception e) {
        ContentUtils.deleteTempFile(monitor,tempFile);
        throw new DBCException(e);
      }
      this.storage=new TemporaryContentStorage(tempFile);
    }
    try {
      blob.free();
    }
 catch (    Throwable e) {
      log.debug(e);
    }
 finally {
      blob=null;
    }
  }
  return storage;
}
