{
  DBDValueHandler keyValueHandler=DBUtils.findValueHandler(session,keyColumn);
  StringBuilder query=new StringBuilder();
  query.append("SELECT ").append(DBUtils.getQuotedIdentifier(keyColumn));
  String descColumns;
  if (dictionary != null) {
    descColumns=dictionary.getDescriptionColumnNames();
  }
 else {
    descColumns=DBVEntity.getDefaultDescriptionColumn(session.getProgressMonitor(),keyColumn);
  }
  if (descColumns != null) {
    query.append(", ").append(descColumns);
  }
  query.append(" FROM ").append(DBUtils.getObjectFullName(keyColumn.getParentObject()));
  List<String> conditions=new ArrayList<>();
  if (keyPattern != null) {
    if (keyPattern instanceof CharSequence) {
      if (((CharSequence)keyPattern).length() > 0) {
        conditions.add(DBUtils.getQuotedIdentifier(keyColumn) + " LIKE ?");
      }
 else {
        keyPattern=null;
      }
    }
 else     if (keyPattern instanceof Number) {
      conditions.add(DBUtils.getQuotedIdentifier(keyColumn) + " >= ?");
    }
 else {
    }
  }
  if (preceedingKeys != null && !preceedingKeys.isEmpty()) {
    for (    DBDAttributeValue precAttribute : preceedingKeys) {
      conditions.add(DBUtils.getQuotedIdentifier(getDataSource(),precAttribute.getAttribute().getName()) + " = ?");
    }
  }
  if (!conditions.isEmpty()) {
    query.append(" WHERE");
    for (int i=0; i < conditions.size(); i++) {
      if (i > 0) {
        query.append(" AND");
      }
      query.append(" ").append(conditions.get(i));
    }
  }
  DBCStatement dbStat=session.prepareStatement(DBCStatementType.QUERY,query.toString(),false,false,false);
  try {
    int paramPos=0;
    if (keyPattern instanceof CharSequence) {
      keyPattern=keyPattern.toString() + "%";
    }
    if (keyPattern != null) {
      keyValueHandler.bindValueObject(session,dbStat,keyColumn,paramPos++,keyPattern);
    }
    if (preceedingKeys != null && !preceedingKeys.isEmpty()) {
      for (      DBDAttributeValue precAttribute : preceedingKeys) {
        DBDValueHandler precValueHandler=DBUtils.findValueHandler(session,precAttribute.getAttribute());
        precValueHandler.bindValueObject(session,dbStat,precAttribute.getAttribute(),paramPos++,precAttribute.getValue());
      }
    }
    dbStat.setLimit(0,maxResults);
    if (dbStat.executeStatement()) {
      try (DBCResultSet dbResult=dbStat.openResultSet()){
        List<DBDLabelValuePair> values=new ArrayList<>();
        List<DBCAttributeMetaData> metaColumns=dbResult.getMeta().getAttributes();
        List<DBDValueHandler> colHandlers=new ArrayList<>(metaColumns.size());
        for (        DBCAttributeMetaData col : metaColumns) {
          colHandlers.add(DBUtils.findValueHandler(session,col));
        }
        while (dbResult.nextRow()) {
          if (session.getProgressMonitor().isCanceled()) {
            break;
          }
          Object keyValue=keyValueHandler.fetchValueObject(session,dbResult,keyColumn,0);
          if (keyValue == null) {
            continue;
          }
          String keyLabel=keyValueHandler.getValueDisplayString(keyColumn,keyValue,DBDDisplayFormat.NATIVE);
          if (descColumns != null) {
            keyLabel="";
            for (int i=1; i < colHandlers.size(); i++) {
              Object descValue=colHandlers.get(i).fetchValueObject(session,dbResult,metaColumns.get(i),i);
              if (!keyLabel.isEmpty()) {
                keyLabel+=" ";
              }
              keyLabel+=colHandlers.get(i).getValueDisplayString(metaColumns.get(i),descValue,DBDDisplayFormat.NATIVE);
            }
          }
          values.add(new DBDLabelValuePair(keyLabel,keyValue));
        }
        return values;
      }
     }
 else {
      return null;
    }
  }
  finally {
    dbStat.close();
  }
}
