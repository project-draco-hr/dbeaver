{
switch (controller.getEditType()) {
case INLINE:
{
      if (controller.getValue() instanceof JDBCContentChars) {
        return new ValueEditor<Text>(controller){
          @Override public void refreshValue(){
            JDBCContentChars newValue=(JDBCContentChars)valueController.getValue();
            control.setText(newValue.getData() == null ? "" : newValue.getData());
          }
          @Override protected Text createControl(          Composite editPlaceholder){
            final Text editor=new Text(editPlaceholder,SWT.NONE);
            editor.setEditable(!valueController.isReadOnly());
            long maxLength=valueController.getAttributeMetaData().getMaxLength();
            if (maxLength <= 0) {
              maxLength=MAX_STRING_LENGTH;
            }
 else {
              maxLength=Math.min(maxLength,MAX_STRING_LENGTH);
            }
            editor.setTextLimit((int)maxLength);
            editor.selectAll();
            return editor;
          }
          @Override public Object extractValue(          DBRProgressMonitor monitor){
            String newValue=control.getText();
            return new JDBCContentChars(valueController.getDataSource(),newValue);
          }
        }
;
      }
 else {
        return null;
      }
    }
case EDITOR:
{
    Object value=controller.getValue();
    if (value instanceof DBDContent && controller instanceof DBDAttributeController) {
      DBDContent content=(DBDContent)value;
      boolean isText=ContentUtils.isTextContent(content);
      List<IContentEditorPart> parts=new ArrayList<IContentEditorPart>();
      if (isText) {
        parts.add(new ContentTextEditorPart());
        if (isXML(content)) {
          parts.add(new ContentXMLEditorPart());
        }
      }
 else {
        parts.add(new ContentBinaryEditorPart());
        parts.add(new ContentTextEditorPart());
        parts.add(new ContentImageEditorPart());
      }
      return ContentEditor.openEditor((DBDAttributeController)controller,parts.toArray(new IContentEditorPart[parts.size()]));
    }
 else {
      controller.showMessage(CoreMessages.model_jdbc_unsupported_content_value_type_,true);
      return null;
    }
  }
case PANEL:
{
  final DBDContent content=(DBDContent)controller.getValue();
  final IContentEditorPart editor;
  final EditorActionBarContributor actionBarContributor;
  if (ContentUtils.isTextContent(content)) {
    if (isXML(content)) {
      editor=new ContentXMLEditorPart();
    }
 else {
      editor=new ContentTextEditorPart();
    }
    actionBarContributor=new BasicTextEditorActionContributor();
  }
 else {
    editor=new ContentBinaryEditorPart();
    actionBarContributor=null;
  }
  final SubEditorSite site=new SubEditorSite(controller.getValueSite());
  return new ValueEditorEx<Control>(controller){
    private DBDContent prevValue=content;
    @Override public void showValueEditor(){
    }
    @Override public void closeValueEditor(){
      ContentEditorInput input=(ContentEditorInput)editor.getEditorInput();
      if (input != null) {
        input.release(VoidProgressMonitor.INSTANCE);
      }
      editor.dispose();
    }
    @Override public void refreshValue(){
      if (prevValue == valueController.getValue()) {
        return;
      }
      prevValue=(DBDContent)valueController.getValue();
      initInput();
    }
    private void initInput(){
      try {
        try {
          ContentEditorInput oldInput=(ContentEditorInput)editor.getEditorInput();
          try {
            ContentEditorInput input=new ContentEditorInput((DBDAttributeController)valueController,new IContentEditorPart[]{editor},VoidProgressMonitor.INSTANCE);
            editor.init(site,input);
          }
  finally {
            if (oldInput != null) {
              oldInput.release(VoidProgressMonitor.INSTANCE);
            }
          }
        }
 catch (        PartInitException e) {
          log.error("Can't initialize content editor",e);
        }
      }
 catch (      DBException e) {
        log.error("Error refreshing content value",e);
      }
    }
    @Override public Object extractValue(    DBRProgressMonitor monitor) throws DBException {
      editor.doSave(monitor.getNestedMonitor());
      ContentEditorInput editorInput=(ContentEditorInput)editor.getEditorInput();
      editorInput.updateContentFromFile(monitor.getNestedMonitor());
      return editorInput.getContent();
    }
    @Override protected Control createControl(    Composite editPlaceholder){
      if (actionBarContributor != null) {
        actionBarContributor.init(site.getActionBars(),site.getPage());
        actionBarContributor.setActiveEditor(editor);
      }
      initInput();
      editor.createPartControl(controller.getEditPlaceholder());
      return editor.getEditorControl();
    }
  }
;
}
default :
return null;
}
}
