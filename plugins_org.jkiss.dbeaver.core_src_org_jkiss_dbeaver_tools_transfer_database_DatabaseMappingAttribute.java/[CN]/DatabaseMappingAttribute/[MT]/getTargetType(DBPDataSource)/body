{
  if (!CommonUtils.isEmpty(targetType)) {
    return targetType;
  }
  String typeName=source.getTypeName();
  DBPDataKind dataKind=source.getDataKind();
  if (targetDataSource instanceof DBPDataTypeProvider) {
    DBPDataTypeProvider dataTypeProvider=(DBPDataTypeProvider)targetDataSource;
    DBSDataType dataType=dataTypeProvider.getDataType(typeName);
    if (dataType == null && typeName.equals("DOUBLE")) {
      dataType=dataTypeProvider.getDataType("DOUBLE PRECISION");
      if (dataType != null) {
        typeName=dataType.getTypeName();
      }
    }
    if (dataType == null) {
      List<DBSDataType> possibleTypes=new ArrayList<DBSDataType>();
      for (      DBSDataType type : dataTypeProvider.getDataTypes()) {
        if (type.getDataKind() == dataKind) {
          possibleTypes.add(type);
        }
      }
      typeName=DBUtils.getDefaultDataTypeName(targetDataSource,dataKind);
      if (!possibleTypes.isEmpty()) {
        DBSDataType targetType=null;
        for (        DBSDataType type : possibleTypes) {
          if (type.getName().equals(typeName)) {
            targetType=type;
            break;
          }
        }
        if (targetType == null) {
          targetType=possibleTypes.get(0);
        }
        typeName=targetType.getTypeName();
      }
    }
    if (dataType != null) {
      dataKind=dataType.getDataKind();
    }
  }
  if (dataKind == DBPDataKind.STRING) {
    typeName+="(" + source.getMaxLength() + ")";
  }
  return typeName;
}
