{
  final Document document=new Document();
  if (sourceText == null) {
    document.set("-- Loading '" + getEditorInput().getName() + "' source...");
    TasksJob.runTask("Read source",new DBRRunnableWithProgress(){
      @Override public void run(      final DBRProgressMonitor monitor) throws InvocationTargetException, InterruptedException {
        try {
          sourceText=getSourceText(monitor);
          if (sourceText == null) {
            sourceText="-- Empty source returned";
          }
        }
 catch (        DBException e) {
          sourceText="/* ERROR WHILE READING SOURCE:\n\n" + e.getMessage() + "\n*/";
          throw new InvocationTargetException(e);
        }
 finally {
          if (!isDisposed()) {
            UIUtils.runInUI(null,new Runnable(){
              @Override public void run(){
                try {
                  doResetDocument(getEditorInput(),monitor.getNestedMonitor());
                }
 catch (                CoreException e) {
                  log.error(e);
                }
              }
            }
);
          }
        }
      }
    }
);
  }
 else {
    document.set(sourceText);
  }
  return document;
}
