{
  DataSourceRegistry activeDataSourceRegistry=DBeaverCore.getInstance().getProjectRegistry().getActiveDataSourceRegistry();
  if (activeDataSourceRegistry == null) {
    UIUtils.showMessageBox(parentShell,CoreMessages.dialog_select_datasource_error_title,CoreMessages.dialog_select_datasource_error_message,SWT.ICON_ERROR);
    return null;
  }
  List<DataSourceDescriptor> datasources=activeDataSourceRegistry.getDataSources();
  if (datasources.isEmpty()) {
    UIUtils.showMessageBox(parentShell,CoreMessages.dialog_select_datasource_error_title,CoreMessages.dialog_select_datasource_error_message,SWT.ICON_ERROR);
    return null;
  }
 else   if (datasources.size() == 1) {
    return datasources.get(0);
  }
 else {
    SelectDataSourceDialog scDialog=new SelectDataSourceDialog(parentShell);
    if (scDialog.open() == IDialogConstants.OK_ID) {
      return scDialog.getDataSource();
    }
 else {
      return null;
    }
  }
}
