{
  try {
    File cacheDir=getLocalCacheDir();
    if (!cacheDir.exists()) {
      if (!cacheDir.mkdirs()) {
        throw new IOException("Can't create cache directory '" + cacheDir.getAbsolutePath() + "'");
      }
    }
    File cacheFile=new File(cacheDir,METADATA_CACHE_FILE);
    OutputStream out=new FileOutputStream(cacheFile);
    try {
      XMLBuilder xml=new XMLBuilder(out,"utf-8");
      xml.setButify(true);
      xml.startElement(TAG_CACHE);
      xml.addAttribute(ATTR_NAME,name);
      xml.addAttribute(ATTR_URL,url);
      for (      MavenArtifact artifact : cachedArtifacts) {
        if (CommonUtils.isEmpty(artifact.getLocalVersions())) {
          continue;
        }
        xml.startElement(TAG_ARTIFACT);
        xml.addAttribute(ATTR_GROUP_ID,artifact.getGroupId());
        xml.addAttribute(ATTR_ARTIFACT_ID,artifact.getArtifactId());
        xml.addAttribute(ATTR_ACTIVE_VERSION,artifact.getActiveVersion());
        for (        MavenLocalVersion version : artifact.getLocalVersions()) {
          xml.startElement(TAG_VERSION);
          xml.addAttribute(ATTR_VERSION,version.getVersion());
          xml.addAttribute(ATTR_FILE,version.getFileName());
          xml.addAttribute(ATTR_UPDATE_TIME,version.getUpdateTime().getTime());
          xml.endElement();
        }
        xml.endElement();
      }
      xml.endElement();
      xml.flush();
    }
  finally {
      IOUtils.close(out);
    }
  }
 catch (  IOException e) {
    log.warn("Error saving local Maven cache",e);
  }
}
