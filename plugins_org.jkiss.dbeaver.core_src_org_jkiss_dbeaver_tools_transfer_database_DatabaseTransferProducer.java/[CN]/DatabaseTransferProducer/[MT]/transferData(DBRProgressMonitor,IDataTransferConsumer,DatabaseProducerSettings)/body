{
  String contextTask=CoreMessages.data_transfer_wizard_job_task_export;
  DBPDataSource dataSource=getSourceObject().getDataSource();
  DBCExecutionContext context=settings.isOpenNewConnections() ? dataSource.openIsolatedContext(monitor,DBCExecutionPurpose.UTIL,contextTask) : dataSource.openContext(monitor,DBCExecutionPurpose.UTIL,contextTask);
  try {
    long totalRows=0;
    if (settings.isQueryRowCount() && (dataContainer.getSupportedFeatures() & DBSDataContainer.DATA_COUNT) != 0) {
      monitor.beginTask(CoreMessages.data_transfer_wizard_job_task_retrieve,1);
      try {
        totalRows=dataContainer.countData(context,dataFilter);
      }
  finally {
        monitor.done();
      }
    }
    monitor.beginTask(CoreMessages.data_transfer_wizard_job_task_export_table_data,(int)totalRows);
    try {
      if (settings.getExtractType() == DatabaseProducerSettings.ExtractType.SINGLE_QUERY) {
        dataContainer.readData(context,consumer,dataFilter,-1,-1);
      }
 else {
        long offset=0;
        int segmentSize=settings.getSegmentSize();
        for (; ; ) {
          long rowCount=dataContainer.readData(context,consumer,dataFilter,offset,segmentSize);
          if (rowCount < segmentSize) {
            break;
          }
          offset+=rowCount;
        }
      }
    }
  finally {
      monitor.done();
    }
  }
  finally {
    context.close();
  }
}
