{
  int sortOrder=grid.getContentProvider().getSortOrder(cell.col);
  Rectangle sortBounds=getSortControlBounds();
  gc.setFont(getColumnFont());
  boolean flat=true;
  boolean drawSelected=((isMouseDown() && isHover()));
  if (flat && isSelected()) {
    gc.setBackground(grid.getCellHeaderSelectionBackground());
  }
 else {
    gc.setBackground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_BACKGROUND));
  }
  gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_LIST_FOREGROUND));
  final Rectangle bounds=getBounds();
  gc.fillRectangle(bounds.x,bounds.y,bounds.width,bounds.height);
  int pushedDrawingOffset=0;
  if (drawSelected) {
    pushedDrawingOffset=1;
  }
  int x=leftMargin;
  Image columnImage=getColumnImage();
  if (columnImage != null) {
    int y=bounds.y + pushedDrawingOffset + topMargin;
    gc.drawImage(columnImage,bounds.x + x + pushedDrawingOffset,y);
    x+=columnImage.getBounds().width + imageSpacing;
  }
  int width=bounds.width - x;
  if (sortOrder == SWT.NONE) {
    width-=rightMargin;
  }
 else {
    width-=arrowMargin + sortBounds.width + arrowMargin;
  }
  int y=bounds.y + topMargin;
  String text=getColumnText();
  text=org.jkiss.dbeaver.ui.TextUtils.getShortString(grid.fontMetrics,text,width);
  gc.drawString(text,bounds.x + x + pushedDrawingOffset,y + pushedDrawingOffset,true);
  if (sortOrder != SWT.NONE) {
    y=bounds.y + topMargin;
    if (drawSelected) {
      sortBounds.x=bounds.x + bounds.width - arrowMargin - sortBounds.width + 1;
      sortBounds.y=y;
    }
 else {
      sortBounds.x=bounds.x + bounds.width - arrowMargin - sortBounds.width;
      sortBounds.y=y;
    }
    paintSort(gc,sortBounds,sortOrder);
  }
  if (!flat) {
    if (drawSelected) {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_NORMAL_SHADOW));
    }
 else {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_HIGHLIGHT_SHADOW));
    }
    gc.drawLine(bounds.x,bounds.y,bounds.x + bounds.width - 1,bounds.y);
    gc.drawLine(bounds.x,bounds.y,bounds.x,bounds.y + bounds.height - 1);
    if (!drawSelected) {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_LIGHT_SHADOW));
      gc.drawLine(bounds.x + 1,bounds.y + 1,bounds.x + bounds.width - 2,bounds.y + 1);
      gc.drawLine(bounds.x + 1,bounds.y + 1,bounds.x + 1,bounds.y + bounds.height - 2);
    }
    if (drawSelected) {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_NORMAL_SHADOW));
    }
 else {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_DARK_SHADOW));
    }
    gc.drawLine(bounds.x + bounds.width - 1,bounds.y,bounds.x + bounds.width - 1,bounds.y + bounds.height - 1);
    gc.drawLine(bounds.x,bounds.y + bounds.height - 1,bounds.x + bounds.width - 1,bounds.y + bounds.height - 1);
    if (!drawSelected) {
      gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_NORMAL_SHADOW));
      gc.drawLine(bounds.x + bounds.width - 2,bounds.y + 1,bounds.x + bounds.width - 2,bounds.y + bounds.height - 2);
      gc.drawLine(bounds.x + 1,bounds.y + bounds.height - 2,bounds.x + bounds.width - 2,bounds.y + bounds.height - 2);
    }
  }
 else {
    gc.setForeground(getDisplay().getSystemColor(SWT.COLOR_WIDGET_DARK_SHADOW));
    gc.drawLine(bounds.x + bounds.width - 1,bounds.y,bounds.x + bounds.width - 1,bounds.y + bounds.height - 1);
    gc.drawLine(bounds.x,bounds.y + bounds.height - 1,bounds.x + bounds.width - 1,bounds.y + bounds.height - 1);
  }
  gc.setFont(grid.getFont());
}
