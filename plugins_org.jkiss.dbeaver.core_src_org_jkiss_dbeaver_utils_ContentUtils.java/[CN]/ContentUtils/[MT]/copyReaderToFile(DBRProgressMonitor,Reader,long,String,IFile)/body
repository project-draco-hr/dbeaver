{
  File file=localFile.getLocation().toFile();
  try {
    OutputStream outputStream=new FileOutputStream(file);
    try {
      if (charset == null) {
        charset=ContentUtils.DEFAULT_FILE_CHARSET;
      }
      Writer writer=new OutputStreamWriter(outputStream,charset);
      ContentUtils.copyStreams(reader,contentLength,writer,monitor);
      writer.flush();
      try {
        localFile.setCharset(charset,monitor.getNestedMonitor());
      }
 catch (      CoreException e) {
        log.warn(e);
      }
    }
  finally {
      outputStream.close();
    }
  }
  finally {
    reader.close();
  }
  syncFile(monitor,localFile);
}
