{
  try {
    OutputStream os=new FileOutputStream(file);
    try {
      copyStreams(contentStream,file.length(),os,monitor);
    }
  finally {
      os.close();
    }
    if (monitor.isCanceled()) {
      if (!file.delete()) {
        log.warn("Can't delete incomplete file '" + file.getAbsolutePath() + "'");
      }
    }
  }
  finally {
    close(contentStream);
  }
}
