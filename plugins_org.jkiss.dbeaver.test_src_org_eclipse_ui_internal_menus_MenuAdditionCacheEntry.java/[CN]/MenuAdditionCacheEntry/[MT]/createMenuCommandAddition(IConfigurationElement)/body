{
  MHandledMenuItem item=MenuFactoryImpl.eINSTANCE.createHandledMenuItem();
  item.setElementId(MenuHelper.getId(commandAddition));
  String commandId=MenuHelper.getCommandId(commandAddition);
  MCommand commandById=ContributionsAnalyzer.getCommandById(application,commandId);
  if (commandById == null) {
    commandById=CommandsFactoryImpl.eINSTANCE.createCommand();
    commandById.setElementId(commandId);
    commandById.setCommandName(commandId);
    application.getCommands().add(commandById);
  }
  item.setCommand(commandById);
  Map parms=MenuHelper.getParameters(commandAddition);
  for (  Object obj : parms.entrySet()) {
    Map.Entry e=(Map.Entry)obj;
    MParameter parm=CommandsFactoryImpl.eINSTANCE.createParameter();
    parm.setName(e.getKey().toString());
    parm.setValue(e.getValue().toString());
    item.getParameters().add(parm);
  }
  String iconUrl=MenuHelper.getIconURI(commandAddition,IWorkbenchRegistryConstants.ATT_ICON);
  if (iconUrl == null) {
    ICommandImageService commandImageService=application.getContext().get(ICommandImageService.class);
    ImageDescriptor descriptor=commandImageService == null ? null : commandImageService.getImageDescriptor(commandId);
    if (descriptor == null) {
      descriptor=commandImageService == null ? null : commandImageService.getImageDescriptor(item.getElementId());
    }
    if (descriptor != null) {
      item.setIconURI(MenuHelper.getImageUrl(descriptor));
    }
  }
 else {
    item.setIconURI(iconUrl);
  }
  if (MenuHelper.getMode(commandAddition) == CommandContributionItem.MODE_FORCE_TEXT) {
    item.getTags().add("FORCE_TEXT");
    item.setLabel(MenuHelper.getLabel(commandAddition));
  }
  item.setLabel(MenuHelper.getLabel(commandAddition));
  item.setMnemonics(MenuHelper.getMnemonic(commandAddition));
  item.setTooltip(MenuHelper.getTooltip(commandAddition));
  item.setType(MenuHelper.getStyle(commandAddition));
  item.setVisibleWhen(MenuHelper.getVisibleWhen(commandAddition));
  createIdentifierTracker(item);
  return item;
}
