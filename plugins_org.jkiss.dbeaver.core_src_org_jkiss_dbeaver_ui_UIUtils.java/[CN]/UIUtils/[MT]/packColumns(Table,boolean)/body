{
  table.setRedraw(false);
  try {
    int totalWidth=0;
    final TableColumn[] columns=table.getColumns();
    for (    TableColumn column : columns) {
      column.pack();
      totalWidth+=column.getWidth();
    }
    final Rectangle clientArea=table.getClientArea();
    if (clientArea.width > 0 && totalWidth > clientArea.width) {
      int extraSpace=totalWidth - clientArea.width;
      for (      TableColumn column : columns) {
        int colWidth=column.getWidth();
        if (colWidth > totalWidth / 3) {
          column.setWidth(totalWidth / 3);
          totalWidth-=colWidth;
          totalWidth+=column.getWidth();
        }
      }
      for (      TableColumn tc : columns) {
        double ratio=(double)tc.getWidth() / totalWidth;
        int newWidth=(int)(tc.getWidth() - extraSpace * ratio);
        tc.setWidth(newWidth);
      }
    }
    if (fit && totalWidth < clientArea.width) {
      float extraSpace=(clientArea.width - totalWidth) / columns.length;
      for (      TableColumn tc : columns) {
        tc.setWidth((int)(tc.getWidth() + extraSpace));
      }
    }
  }
  finally {
    table.setRedraw(true);
  }
}
