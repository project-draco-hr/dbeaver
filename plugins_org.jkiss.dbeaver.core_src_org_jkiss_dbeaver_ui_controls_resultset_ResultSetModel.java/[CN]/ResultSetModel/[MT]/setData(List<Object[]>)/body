{
  this.clearData();
  if (metadataChanged) {
    if (columns.length == 1 && columns[0].getDataKind() == DBPDataKind.STRUCT) {
      List<DBDAttributeBinding> nested=columns[0].getNestedBindings();
      if (!CommonUtils.isEmpty(nested)) {
        columns=nested.toArray(new DBDAttributeBinding[nested.size()]);
        fillVisibleColumns();
      }
    }
  }
  appendData(rows);
  if (sourceChanged) {
    this.dataFilter=createDataFilter();
  }
 else {
    DBDDataFilter prevFilter=dataFilter;
    this.dataFilter=createDataFilter();
    updateDataFilter(prevFilter);
  }
  if (metadataChanged) {
    this.singleSourceCells=true;
    DBSEntity sourceTable=null;
    for (    DBDAttributeBinding column : visibleColumns) {
      DBDRowIdentifier rowIdentifier=column.getRowIdentifier();
      if (rowIdentifier != null) {
        if (sourceTable == null) {
          sourceTable=rowIdentifier.getEntity();
        }
 else         if (sourceTable != rowIdentifier.getEntity()) {
          singleSourceCells=false;
          break;
        }
      }
 else {
        singleSourceCells=false;
        break;
      }
    }
  }
  hasData=true;
  metadataChanged=false;
  sourceChanged=false;
}
