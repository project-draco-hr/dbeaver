{
  this.clearData();
  if (metadataChanged) {
    if (attributes.length == 1 && attributes[0].getDataKind() == DBPDataKind.DOCUMENT) {
      List<DBDAttributeBinding> nested=attributes[0].getNestedBindings();
      if (nested != null && !nested.isEmpty()) {
        attributes=nested.toArray(new DBDAttributeBinding[nested.size()]);
        fillVisibleAttributes();
      }
    }
  }
  appendData(rows);
  if (sourceChanged) {
    this.dataFilter=createDataFilter();
  }
 else {
    DBDDataFilter prevFilter=dataFilter;
    this.dataFilter=createDataFilter();
    updateDataFilter(prevFilter);
  }
  if (metadataChanged) {
    this.singleSourceCells=true;
    DBSEntity sourceTable=null;
    for (    DBDAttributeBinding attribute : visibleAttributes) {
      DBDRowIdentifier rowIdentifier=attribute.getRowIdentifier();
      if (rowIdentifier != null) {
        if (sourceTable == null) {
          sourceTable=rowIdentifier.getEntity();
        }
 else         if (sourceTable != rowIdentifier.getEntity()) {
          singleSourceCells=false;
          break;
        }
      }
 else {
        singleSourceCells=false;
        break;
      }
    }
  }
  hasData=true;
  metadataChanged=false;
  sourceChanged=false;
}
