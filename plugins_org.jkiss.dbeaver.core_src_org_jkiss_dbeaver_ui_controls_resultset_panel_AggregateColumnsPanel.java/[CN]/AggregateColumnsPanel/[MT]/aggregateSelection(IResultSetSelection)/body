{
  List<AggregateFunctionDescriptor> functions=new ArrayList<>(FunctionsRegistry.getInstance().getFunctions());
  Collections.sort(functions,new Comparator<AggregateFunctionDescriptor>(){
    @Override public int compare(    AggregateFunctionDescriptor o1,    AggregateFunctionDescriptor o2){
      return o1.getLabel().compareTo(o2.getLabel());
    }
  }
);
  ResultSetModel model=presentation.getController().getModel();
  for (  AggregateFunctionDescriptor funcDesc : functions) {
    try {
      int valueCount=0;
      IAggregateFunction func=funcDesc.createFunction();
      for (Iterator iter=selection.iterator(); iter.hasNext(); ) {
        Object element=iter.next();
        DBDAttributeBinding attr=selection.getElementAttribute(element);
        ResultSetRow row=selection.getElementRow(element);
        Object cellValue=model.getCellValue(attr,row);
        if (cellValue instanceof Number) {
          func.accumulate((Number)cellValue);
          valueCount++;
        }
      }
      TreeItem funcItem=new TreeItem(aggregateTable,SWT.NONE);
      funcItem.setText(0,funcDesc.getLabel());
      funcItem.setImage(0,DBeaverIcons.getImage(funcDesc.getIcon()));
      if (valueCount > 0) {
        Number result=func.getResult(valueCount);
        if (result != null) {
          funcItem.setText(1,result.toString());
        }
      }
    }
 catch (    Exception e) {
      log.error(e);
    }
  }
}
