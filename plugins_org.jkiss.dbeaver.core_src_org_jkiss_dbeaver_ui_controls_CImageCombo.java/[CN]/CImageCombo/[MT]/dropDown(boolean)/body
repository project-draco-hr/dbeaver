{
  if (drop == isDropped()) {
    return;
  }
  if (!drop) {
    this.popup.setVisible(false);
    if (!isDisposed() && this.arrow.isFocusControl()) {
      this.comboComposite.setFocus();
    }
    return;
  }
  if (getShell() != this.popup.getParent()) {
    int selectionIndex=this.table.getSelectionIndex();
    this.table.removeListener(SWT.Dispose,this.listener);
    createPopup(selectionIndex);
  }
  int index=this.table.getSelectionIndex();
  if (index != -1) {
    this.table.setTopIndex(index);
  }
  Display display=getDisplay();
  Rectangle listRect=this.table.getBounds();
  Rectangle parentRect=display.map(getParent(),null,getBounds());
  Point comboSize=getSize();
  Rectangle displayRect=getMonitor().getClientArea();
  int width=comboSize.x;
  int height=listRect.height;
  int x=parentRect.x;
  int y=parentRect.y + comboSize.y;
  if (y + height > displayRect.y + displayRect.height) {
    y=parentRect.y - height;
  }
  this.popup.setBounds(x,y,width,height);
  this.popup.layout();
  table.getColumn(0).setWidth(table.getSize().x - table.getVerticalBar().getSize().x);
  this.popup.setVisible(true);
  this.table.setFocus();
}
