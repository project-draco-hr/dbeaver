{
  SQLDataSource dataSource=getDataSource();
  if (dataSource != null) {
    DBCServerOutputReader outputReader=DBUtils.getAdapter(DBCServerOutputReader.class,dataSource);
    if (outputReader != null && outputReader.isServerOutputEnabled()) {
      dumpServerOutput(dataSource,outputReader);
    }
  }
  if (result.hasError()) {
    setStatus(result.getError().getMessage(),true);
  }
  if (!scriptMode) {
    getSelectionProvider().setSelection(originalSelection);
  }
  QueryResultsProvider results=queryProcessor.getResults(result.getStatement());
  if (results != null) {
    CTabItem tabItem=results.tabItem;
    if (!tabItem.isDisposed()) {
      tabItem.setToolTipText(result.getStatement().getQuery());
      if (!CommonUtils.isEmpty(result.getResultSetName())) {
        tabItem.setText(result.getResultSetName());
      }
    }
  }
  if (result.getQueryTime() > DBeaverCore.getGlobalPreferenceStore().getLong(DBeaverPreferences.AGENT_LONG_OPERATION_TIMEOUT) * 1000) {
    DBeaverUI.notifyAgent("Query completed [" + getEditorInput().getPath().lastSegment() + "]"+ ContentUtils.getDefaultLineSeparator()+ CommonUtils.truncateString(result.getStatement().getQuery(),200),!result.hasError() ? IStatus.INFO : IStatus.ERROR);
  }
}
