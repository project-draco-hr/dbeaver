{
  collectChanges();
  for (  RowData row : changedRows) {
    if (row.changes != null) {
      for (      Map.Entry<DBDAttributeBinding,Object> changedValue : row.changes.entrySet()) {
        Object curValue=model.getCellValue(row,changedValue.getKey());
        ResultSetModel.releaseValue(curValue);
        model.updateCellValue(row,changedValue.getKey(),changedValue.getValue(),false);
      }
      row.changes=null;
    }
  }
  boolean rowsChanged=model.cleanupRows(addedRows);
  for (  RowData row : deletedRows) {
    row.state=RowData.STATE_NORMAL;
  }
  model.refreshChangeCount();
  viewer.refreshSpreadsheet(rowsChanged);
  viewer.fireResultSetChange();
  viewer.updateEditControls();
  viewer.previewValue();
}
