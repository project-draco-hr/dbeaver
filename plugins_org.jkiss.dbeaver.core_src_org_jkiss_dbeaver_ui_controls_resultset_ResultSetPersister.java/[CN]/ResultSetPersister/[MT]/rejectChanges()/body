{
  collectChanges();
  for (  RowData row : changedRows) {
    if (row.changes != null) {
      for (      Map.Entry<DBDAttributeBinding,Object> changedValue : row.changes.entrySet()) {
        Object curValue=model.getCellValue(changedValue.getKey(),row);
        ResultSetModel.releaseValue(curValue);
        model.updateCellValue(changedValue.getKey(),row,changedValue.getValue(),false);
      }
      row.changes=null;
    }
  }
  boolean rowsChanged=model.cleanupRows(addedRows);
  for (  RowData row : deletedRows) {
    row.setState(RowData.STATE_NORMAL);
  }
  model.refreshChangeCount();
  viewer.refreshSpreadsheet(rowsChanged);
  viewer.fireResultSetChange();
  viewer.updateEditControls();
  viewer.previewValue();
}
