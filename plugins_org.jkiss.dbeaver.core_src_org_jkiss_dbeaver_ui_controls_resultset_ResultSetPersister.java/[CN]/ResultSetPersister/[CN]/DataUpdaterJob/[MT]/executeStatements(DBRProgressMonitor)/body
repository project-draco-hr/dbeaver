{
  DBCExecutionContext context=getDataSource().openContext(monitor,DBCExecutionPurpose.UTIL,CoreMessages.controls_resultset_viewer_execute_statement_context_name);
  try {
    monitor.beginTask(CoreMessages.controls_resultset_viewer_monitor_aply_changes,ResultSetPersister.this.deleteStatements.size() + ResultSetPersister.this.insertStatements.size() + ResultSetPersister.this.updateStatements.size());
    try {
      this.autocommit=context.getTransactionManager().isAutoCommit();
    }
 catch (    DBCException e) {
      ResultSetViewer.log.warn("Could not determine autocommit state",e);
      this.autocommit=true;
    }
    if (!this.autocommit && context.getTransactionManager().supportsSavepoints()) {
      try {
        this.savepoint=context.getTransactionManager().setSavepoint(null);
      }
 catch (      Throwable e) {
        ResultSetViewer.log.debug("Could not set savepoint",e);
      }
    }
    try {
      for (      DataStatementInfo statement : ResultSetPersister.this.deleteStatements) {
        if (monitor.isCanceled())         break;
        try {
          DBSDataManipulator dataContainer=getDataManipulator(statement.table);
          deleteCount+=dataContainer.deleteData(context,statement.keyAttributes);
          processStatementChanges(statement);
        }
 catch (        DBException e) {
          processStatementError(statement,context);
          return e;
        }
        monitor.worked(1);
      }
      for (      DataStatementInfo statement : ResultSetPersister.this.insertStatements) {
        if (monitor.isCanceled())         break;
        try {
          DBSDataManipulator dataContainer=getDataManipulator(statement.table);
          insertCount+=dataContainer.insertData(context,statement.keyAttributes,statement.needKeys() ? new KeyDataReceiver(statement) : null);
          processStatementChanges(statement);
        }
 catch (        DBException e) {
          processStatementError(statement,context);
          return e;
        }
        monitor.worked(1);
      }
      for (      DataStatementInfo statement : ResultSetPersister.this.updateStatements) {
        if (monitor.isCanceled())         break;
        try {
          DBSDataManipulator dataContainer=getDataManipulator(statement.table);
          this.updateCount+=dataContainer.updateData(context,statement.keyAttributes,statement.updateAttributes,null);
          processStatementChanges(statement);
        }
 catch (        DBException e) {
          processStatementError(statement,context);
          return e;
        }
        monitor.worked(1);
      }
      return null;
    }
  finally {
      if (this.savepoint != null) {
        try {
          context.getTransactionManager().releaseSavepoint(this.savepoint);
        }
 catch (        Throwable e) {
          ResultSetViewer.log.debug("Could not release savepoint",e);
        }
      }
    }
  }
  finally {
    monitor.done();
    context.close();
  }
}
