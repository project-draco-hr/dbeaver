{
  boolean drawAsSelected=isSelected();
  boolean drawBackground=true;
  if (isCellSelected()) {
    drawAsSelected=true;
  }
  if (drawAsSelected) {
    Color cellBackground=grid.getCellBackground(cell);
    if (cellBackground.equals(grid.getBackground())) {
      gc.setBackground(colorSelected);
    }
 else {
      RGB cellSel=LightGrid.blend(cellBackground.getRGB(),colorSelectedRGB,50);
      gc.setBackground(DBeaverUI.getSharedTextColors().getColor(cellSel));
    }
    gc.setForeground(colorSelectedText);
  }
 else {
    if (grid.isEnabled()) {
      Color back=grid.getCellBackground(cell);
      if (back != null) {
        gc.setBackground(back);
      }
 else {
        drawBackground=false;
      }
    }
 else {
      gc.setBackground(colorBackgroundDisabled);
    }
    gc.setForeground(grid.getCellForeground(cell));
  }
  if (drawBackground)   gc.fillRectangle(bounds.x,bounds.y,bounds.width,bounds.height);
  int x=LEFT_MARGIN;
  Image image=grid.getCellImage(cell);
  if (image != null) {
    Rectangle imageBounds=image.getBounds();
    int y=bounds.y + (bounds.height - imageBounds.height) / 2;
    gc.drawImage(image,bounds.x + x,y);
    x+=imageBounds.width + INSIDE_MARGIN;
  }
  int width=bounds.width - x - RIGHT_MARGIN;
  int state=grid.getContentProvider().getCellState(cell);
  String text=grid.getCellText(cell);
  if (text != null && !text.isEmpty()) {
    text=TextUtils.getShortString(grid.fontMetrics,text,width);
    text=text.replace('\n',UIUtils.PARAGRAPH_CHAR).replace('\r',' ').replace((char)0,' ');
    gc.setFont(grid.normalFont);
    if ((state & IGridContentProvider.STATE_LINK) != 0) {
      Point textSize=gc.textExtent(text);
      gc.drawLine(bounds.x + x,bounds.y + TEXT_TOP_MARGIN + TOP_MARGIN+ textSize.y - 1,bounds.x + x + textSize.x,bounds.y + TEXT_TOP_MARGIN + TOP_MARGIN+ textSize.y - 1);
    }
    gc.drawString(text,bounds.x + x,bounds.y + TEXT_TOP_MARGIN + TOP_MARGIN,true);
  }
  if (grid.isLinesVisible()) {
    if (isCellSelected()) {
      gc.setForeground(colorLineForeground);
    }
 else {
      gc.setForeground(grid.getLineColor());
    }
    gc.drawLine(bounds.x,bounds.y + bounds.height,bounds.x + bounds.width - 1,bounds.y + bounds.height);
    gc.drawLine(bounds.x + bounds.width - 1,bounds.y,bounds.x + bounds.width - 1,bounds.y + bounds.height);
  }
  if (isCellFocus()) {
    gc.setForeground(colorLineFocused);
    gc.drawRectangle(bounds.x,bounds.y,bounds.width - 1,bounds.height);
    if (isFocus()) {
      gc.drawRectangle(bounds.x + 1,bounds.y + 1,bounds.width - 3,bounds.height - 2);
    }
  }
}
