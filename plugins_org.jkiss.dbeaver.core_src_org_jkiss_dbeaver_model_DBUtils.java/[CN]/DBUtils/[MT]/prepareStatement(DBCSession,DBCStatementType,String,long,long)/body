{
  final boolean selectQuery=SQLSemanticProcessor.isSelectQuery(query);
  final boolean hasLimits=selectQuery && offset >= 0 && maxRows > 0;
  DBCQueryTransformer limitTransformer=null, fetchAllTransformer=null;
  if (selectQuery) {
    DBCQueryTransformProvider transformProvider=DBUtils.getAdapter(DBCQueryTransformProvider.class,session.getDataSource());
    if (transformProvider != null) {
      if (hasLimits) {
        limitTransformer=transformProvider.createQueryTransformer(DBCQueryTransformType.RESULT_SET_LIMIT);
      }
 else {
        fetchAllTransformer=transformProvider.createQueryTransformer(DBCQueryTransformType.FETCH_ALL_TABLE);
      }
    }
  }
  if (hasLimits && limitTransformer != null) {
    limitTransformer.setParameters(offset,maxRows);
    query=limitTransformer.transformQueryString(query);
  }
 else   if (fetchAllTransformer != null) {
    query=fetchAllTransformer.transformQueryString(query);
  }
  DBCStatement dbStat=statementType == DBCStatementType.SCRIPT ? createStatement(session,query) : prepareStatement(session,query);
  if (hasLimits || offset > 0) {
    if (limitTransformer == null) {
      dbStat.setLimit(offset,maxRows);
    }
 else {
      limitTransformer.transformStatement(dbStat,0);
    }
  }
 else   if (fetchAllTransformer != null) {
    fetchAllTransformer.transformStatement(dbStat,0);
  }
  return dbStat;
}
