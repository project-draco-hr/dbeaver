{
  ResultSet dbResult=array.getResultSet();
  if (dbResult == null) {
    log.debug("JDBC array type was not resolved and result set was not provided by driver. Return NULL.");
    return null;
  }
  if (type == null || valueHandler == null) {
    JDBCColumnMetaData itemMeta=new JDBCColumnMetaData(session.getDataSource(),dbResult.getMetaData(),1);
    if (type == null) {
      type=DBUtils.resolveDataType(session.getProgressMonitor(),session.getDataSource(),itemMeta.getTypeName());
      if (type == null) {
        type=new JDBCDataType(session.getDataSource(),itemMeta);
      }
    }
    valueHandler=DBUtils.findValueHandler(session,itemMeta);
  }
  try {
    DBCResultSet resultSet=JDBCResultSetImpl.makeResultSet(session,null,dbResult,ModelMessages.model_jdbc_array_result_set,true);
    try {
      List<Object> data=new ArrayList<>();
      while (dbResult.next()) {
        data.add(valueHandler.fetchValueObject(session,resultSet,type,1));
      }
      return new JDBCArray(type,valueHandler,data.toArray());
    }
  finally {
      resultSet.close();
    }
  }
  finally {
    try {
      dbResult.close();
    }
 catch (    SQLException e) {
      log.debug("Can't close array result set",e);
    }
  }
}
