{
  for (int i=0; i < stateHistory.size(); i++) {
    StateItem item=stateHistory.get(i);
    if (item.dataContainer == dataContainer && item.filter == dataFilter) {
      curState=item;
      historyPosition=i;
      return;
    }
  }
  while (historyPosition < stateHistory.size() - 1) {
    stateHistory.remove(stateHistory.size() - 1);
  }
  curState=new StateItem(dataContainer,dataFilter,curRow == null ? -1 : curRow.visualNumber);
  stateHistory.add(curState);
  historyPosition=stateHistory.size() - 1;
}
