{
  boolean enableFilters=false;
  DBPDataSource dataSource=getDataSource();
  if (dataSource != null) {
    StringBuilder where=new StringBuilder();
    model.getDataFilter().appendConditionString(dataSource,where);
    String whereCondition=where.toString().trim();
    filtersText.setText(whereCondition);
    if (!whereCondition.isEmpty()) {
      addFiltersHistory(whereCondition);
    }
    if (resultSetProvider.isReadyToRun() && !model.isUpdateInProgress() && (!CommonUtils.isEmpty(whereCondition) || (getModel().getVisibleColumnCount() > 0 && supportsDataFilter()))) {
      enableFilters=true;
    }
  }
  if (enableFilters) {
    if (filtersEnableState != null) {
      filtersEnableState.restore();
      filtersEnableState=null;
    }
  }
 else   if (filtersEnableState == null) {
    filtersEnableState=ControlEnableState.disable(filtersPanel);
  }
}
