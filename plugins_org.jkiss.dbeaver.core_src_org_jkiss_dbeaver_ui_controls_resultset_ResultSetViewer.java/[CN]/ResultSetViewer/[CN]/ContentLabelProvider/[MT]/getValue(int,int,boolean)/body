{
  Object value;
  DBDAttributeBinding column;
  int rowNum;
  int rowCount=model.getRowCount();
  if (gridMode == GridMode.RECORD) {
    rowNum=curRowNum;
    if (curRowNum >= rowCount || curRowNum < 0) {
      return "";
    }
    column=model.getVisibleColumn(row);
    Object[] values=model.getRowData(curRowNum);
    if (column.getAttributeIndex() >= values.length) {
      log.warn("Bad record row number: " + row);
      return null;
    }
    value=values[column.getAttributeIndex()];
  }
 else {
    rowNum=row;
    if (row >= rowCount) {
      log.warn("Bad grid row number: " + row);
      return null;
    }
    if (col >= model.getVisibleColumnCount()) {
      log.warn("Bad grid column number: " + col);
      return null;
    }
    column=model.getVisibleColumn(col);
    value=model.getCellValue(row,column.getAttributeIndex());
  }
  if (rowNum == rowCount - 1 && (gridMode == GridMode.RECORD || spreadsheet.isRowVisible(rowNum)) && dataReceiver.isHasMoreData()) {
    readNextSegment();
  }
  if (formatString) {
    return column.getValueHandler().getValueDisplayString(column.getMetaAttribute(),value,DBDDisplayFormat.UI);
  }
 else {
    return value;
  }
}
