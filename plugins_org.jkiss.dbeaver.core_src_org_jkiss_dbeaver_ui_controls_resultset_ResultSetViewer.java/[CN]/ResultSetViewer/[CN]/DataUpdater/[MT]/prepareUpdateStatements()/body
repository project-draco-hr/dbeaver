{
  prepareUpdateRows();
  if (updatedRows == null) {
    return;
  }
  for (  Integer rowNum : updatedRows.keySet()) {
    Map<DBSEntity,TableRowInfo> tableMap=updatedRows.get(rowNum);
    for (    DBSEntity table : tableMap.keySet()) {
      TableRowInfo rowInfo=tableMap.get(table);
      DataStatementInfo statement=new DataStatementInfo(DBSManipulationType.UPDATE,new RowInfo(rowNum),table);
      for (int i=0; i < rowInfo.tableCells.size(); i++) {
        GridPos cell=rowInfo.tableCells.get(i);
        DBDAttributeBinding metaColumn=metaColumns[cell.col];
        statement.updateAttributes.add(new DBDAttributeValue(metaColumn.getEntityAttribute(),curRows.get(rowNum)[cell.col]));
      }
      Collection<? extends DBCAttributeMetaData> idColumns=rowInfo.id.getResultSetColumns();
      for (      DBCAttributeMetaData idAttribute : idColumns) {
        int columnIndex=getMetaColumnIndex(idAttribute);
        if (columnIndex < 0) {
          throw new DBCException("Can't find meta column for ID column " + idAttribute.getName());
        }
        DBDAttributeBinding metaColumn=metaColumns[columnIndex];
        Object keyValue=curRows.get(rowNum)[columnIndex];
        for (        GridPos cell : editedValues.keySet()) {
          if (cell.equals(columnIndex,rowNum)) {
            keyValue=editedValues.get(cell);
          }
        }
        statement.keyAttributes.add(new DBDAttributeValue(metaColumn.getEntityAttribute(),keyValue));
      }
      updateStatements.add(statement);
    }
  }
}
